<div class="filters">
  <div class="zone-infos" *ngIf="(zoneInfos$ | async) as zoneInfos" cdk-scrollable>
    <ng-container *ngIf="(allInfo$ | async) as allInfo">
      <zone-info
        [info]="allInfo"
        [selected]="zoneInfoSelected === 'all'"
        class="zone-info"
        (click)="onZoneInfoClick('all', 0)"
      ></zone-info>
    </ng-container>
    <ng-container *ngIf="zoneInfos.length > 1">
      <ng-container
        *ngFor="let info$ of zoneInfos; let arrayIndex = index; trackBy: trackbyIndexFn"
      >
        <ng-container *ngIf="(info$ | async) as info">
          <zone-info
            [info]="info"
            [selected]="info.id === zoneInfoSelected"
            class="zone-info"
            (click)="onZoneInfoClick(info.id, arrayIndex + 1)"
          ></zone-info>
        </ng-container>
      </ng-container>
    </ng-container>
    <ng-container *ngIf="(featureInfo$ | async) as featureInfo">
      <zone-info
        [info]="featureInfo"
        [selected]="zoneInfoSelected === 'feature'"
        class="zone-info"
        (click)="onZoneInfoClick('feature', zoneInfos.length + 1)"
      ></zone-info>
    </ng-container>
    <div class="push"></div>
  </div>
</div>

<ng-container *ngIf="(sortBy$ | async) === 'zone'; else sorted">
  <div class="zones" *ngIf="(zoneTables$ | async) as zoneTables">
    <ng-container *ngFor="let zone of (zones$ | async); let zoneIndex = index">
      <div class="zone" *ngIf="zoneInfoSelected === 'all' || zoneInfoSelected === '' + zoneIndex">
        <div class="zone_title">{{ zone.name }}</div>
        <div class="section" *ngFor="let section of zone.sections; let sectionIndex = index">
          <table
            [table]="table"
            [viewMode]="viewMode"
            [isOutstandings]="isOutstandings$ | async"
            (openTable)="onOpenTable(table)"
            class="table"
            *ngFor="
              let table of (zoneTables[zoneIndex][sectionIndex] | async);
              trackBy: trackbyIdFn
            "
          ></table>
        </div>
      </div>
    </ng-container>
    <div class="zone" *ngIf="zoneInfoSelected === 'all' || zoneInfoSelected === 'feature'">
      <div class="zone_title">Feature</div>
      <div class="section">
        <table
          [table]="table"
          [viewMode]="viewMode"
          [isOutstandings]="isOutstandings$ | async"
          [displayFeatured]="true"
          (openTable)="onOpenTable(table)"
          class="table"
          *ngFor="let table of (featureTables$ | async); trackBy: trackbyIdFn"
        ></table>
      </div>
    </div>
  </div>
</ng-container>

<ng-template #sorted>
  <div class="all-tables">
    <table
      [table]="table"
      [viewMode]="viewMode"
      [isOutstandings]="isOutstandings$ | async"
      (openTable)="onOpenTable(table)"
      class="table"
      *ngFor="let table of (sortedTables$ | async); trackBy: trackbyIdFn"
    ></table>
  </div>
</ng-template>

<ng-template #header let-disabled="disabled">
  <tournament-header
    [disabled]="disabled"
    [viewMode]="viewMode"
    (editClock)="onEditClock()"
    (editFilters)="onEditFilter()"
    (openActions)="onOpenActions()"
    (toggleViewMode)="toggleViewMode()"
  ></tournament-header>
</ng-template>
<ng-template #menuHeader>{{ (tournament$ | async)?.name }}</ng-template>
<ng-template #clock><clock-panel (clockSet)="closePanel()"></clock-panel></ng-template>
<ng-template #filters
  ><filters-panel
    [filters]="filters$ | async"
    [sortBy]="sortBy$ | async"
    [isOutstandings]="isOutstandings$ | async"
  ></filters-panel
></ng-template>
<ng-template #actions
  ><actions-panel
    [actions]="actions$ | async"
    (actionClick)="onActionClick($event)"
    [isLoading]="isRestarting"
  ></actions-panel
></ng-template>
<ng-template #addTime
  ><add-time-panel [table]="selectedTable" (timeAdded)="onTimeAdded()"></add-time-panel
></ng-template>
<ng-template #assignJudge
  ><assign-judge-panel
    [table]="selectedTable"
    (judgeAssignated)="onJudgeAssignated()"
  ></assign-judge-panel
></ng-template>
<ng-template #table
  ><table-panel
    [table]="selectedTable"
    (addTime)="onAddTime(selectedTable)"
    (assignJudge)="onAssignJudge(selectedTable)"
  ></table-panel
></ng-template>
<ng-template #importPairings
  ><import-pairings-panel
    (pairingsImported)="onPairingsImported()"
    [software]="software$ | async"
  ></import-pairings-panel
></ng-template>
<ng-template #importResults
  ><import-results-panel
    (resultsImported)="onResultsImported()"
    [software]="software$ | async"
  ></import-results-panel
></ng-template>
<ng-template #outstandings
  ><outstandings-panel
    (outstandingsDefined)="onOutstandingsDefined()"
    [isOutstandings]="isOutstandings$ | async"
  ></outstandings-panel
></ng-template>
<ng-template #markAllEmpty>
  <mark-all-empty-panel
    [zones]="zones$ | async"
    [status]="markAllEmptyStatus"
    (allEmptyMarked)="onAllEmptyMarked()"
  >
  </mark-all-empty-panel
></ng-template>
<ng-template #goNext><go-next-panel (goNext)="onGoNext()"></go-next-panel></ng-template>
<ng-template #changeRoles
  ><change-roles-panel
    (rolesChanged)="onRolesChanged()"
    [staff]="staff$ | async"
  ></change-roles-panel
></ng-template>
<ng-template #setFeature
  ><set-feature-panel [tables]="featureTables$ | async"></set-feature-panel
></ng-template>
